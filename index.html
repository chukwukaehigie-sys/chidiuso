<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Med Checker Companion</title>
  <link rel="stylesheet" href="simpmedcheck.css" />
  <style>
    .language-selector {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .translated-content {
      transition: all 0.3s ease;
    }

    .remove-btn {
      background: #e74c3c;
      color: white;
      border: none;
      padding: 4px 8px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.8em;
      margin-left: 10px;
    }
    
    .remove-btn:hover {
      background: #c0392b;
    }

    /* Narration button styles */
    .narration-btn {
      background: linear-gradient(135deg, #2196F3, #1976D2);
      color: white;
      border: none;
      border-radius: 10px;
      padding: 12px 20px;
      cursor: pointer;
      font-weight: bold;
      font-size: 18px;
      margin: 15px auto;
      display: block;
      transition: all 0.3s ease;
    }

    .narration-btn:hover {
      background: linear-gradient(135deg, #1976D2, #1565C0);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(33, 150, 243, 0.4);
    }

    .narration-btn:disabled {
      background: #cccccc;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    /* Speaking indicator */
    .speaking {
      background-color: #e8f5e8 !important;
      border: 2px solid #4CAF50 !important;
    }
  </style>
</head>
<body>
  <header>
    <nav class="utility-bar">
      <a href="index.html" style="text-decoration: none;"><button id="homeBtn">üè† <span data-translate="home">Home</span></button></a>
      <a href="schedule.html" style="text-decoration: none;"><button id="scheduleBtn">üìÖ <span data-translate="schedule">Schedule</span></button></a>
      <a href="settings.html" style="text-decoration: none;"><button id="settingsBtn">‚öôÔ∏è <span data-translate="settings">Settings</span></button></a>
      <a href="howtouse.html" style="text-decoration: none;"><button>‚ùì <span data-translate="howToUse">How to Use</span></button></a>
      <a href="added-medications.html" style="text-decoration: none;"><button>üíä <span data-translate="addedMeds">Added Medications</span></button></a>
      <a href="profile.html" style="text-decoration: none;"><button>üë§ <span data-translate="profile">Profile</span></button></a>

      <div class="language-selector">
        <select class="lS" id="languageSelect">
          <option value="en">English</option>
          <option value="ig">Igbo</option>
          <option value="yo">Yoruba</option>
          <option value="ha">Hausa</option>
        </select>
      </div>
    </nav>

    <h1>üëµ <span data-translate="appName">MedMinder</span></h1>
    <!-- Personalized Greeting -->
<div id="personalGreeting" style="text-align: center; font-size: 1.8em; margin: 20px 0; padding: 15px; background: linear-gradient(135deg, #4CAF50, #45a049); color: white; border-radius: 10px;">
    Welcome to MedMinder!
</div>
    <p id="headerGreeting" data-translate="welcome">Welcome, Chidiuso!</p>
    <p id="headerTime"></p>
    <p id="dailyQuote"></p>

    <!-- Narration Button -->
    <button class="narration-btn" id="narrationBtn">
  </header>

  <main>
    <section style="font-size: 30px; height: auto;" id="homeSection" class="utility-section">
      <span data-translate="welcomeMessage">Welcome to MedMinder!</span>
    </section>

    <section class="med-list">
      <h2>üïí <span data-translate="todaysMeds">Today's Medications</span></h2>
      <ul id="medications">
        <!-- Medications will be dynamically added here -->
      </ul>
    </section>

    <section class="add-med">
      <h2>‚ûï <span data-translate="addNewMed">Add a New Medication</span></h2>
      <form id="medForm">
        <label for="medDate" data-translate="dateLabel">Date</label>
        <input id="medDate" type="date" required />
        
        <label for="medName" data-translate="medNameLabel">Medication Name</label>
        <input id="medName" type="text" placeholder="e.g. Vitamin D" required />

        <label for="dosage" data-translate="dosageLabel">Dosage</label>
        <input id="dosage" type="text" placeholder="e.g. 500mg" required />

        <label for="time" data-translate="timeLabel">Time to Take</label>
        <input id="time" type="time" required />

        <button type="submit" data-translate="addMedButton">Add Medication</button>
      </form>
    </section>
  </main>

  <footer>
    <p><span data-translate="copyright">MedMinder ¬© 2025</span></p>
    <p><span data-translate="designedFor">Designed with care for older adults</span> | <a href="#" data-translate="privacyPolicy">Privacy Policy</a></p>
  </footer>

  <script>
    // Comprehensive translations for all content - SINGLE DEFINITION
    const translations = {
      en: {
        home: "Home", schedule: "Schedule", reminders: "Reminders", settings: "Settings",
        howToUse: "How to Use", addedMeds: "Added Medications", profile: "Profile",
        appName: "MedMinder", welcome: "Welcome, Chidiuso!", welcomeMessage: "Welcome to MedMinder!",
        todaysMeds: "Today's Medications", addNewMed: "Add a New Medication", dayLabel: "Day",
        medNameLabel: "Medication Name", dosageLabel: "Dosage", timeLabel: "Time to Take",
        addMedButton: "Add Medication", copyright: "MedMinder ¬© 2025",
        designedFor: "Designed with care for older adults", privacyPolicy: "Privacy Policy",
        dayPlaceholder: "e.g. Monday", medNamePlaceholder: "e.g. Vitamin D", dosagePlaceholder: "e.g. 500mg",
        medicationAdded: "Medication Added", reminderAlert: "‚è∞ Reminder: Take {name} ({dose}) in 30 minutes",
        goodMorning: "Good morning", goodAfternoon: "Good afternoon", goodEvening: "Good evening",
        readPage: "Read This Page Aloud", stopReading: "Stop Reading",
        quotes: [
          "Your health is your wealth üíô", "Every dose is a step toward strength.",
          "You're doing great ‚Äî keep going!", "Small steps, big impact. Take your meds!",
          "The body knows how to heal ‚Äî we just need to listen."
        ]
      },
      ig: {
        home: "·ª§l·ªç", schedule: "Nhazi oge", reminders: "Ncheta", settings: "Nt·ªçala",
        howToUse: "Otu esi eji", addedMeds: "·ªågw·ª• Agbakwunyere", profile: "Profa·ªãl·ª•",
        appName: "MedMinder", welcome: "Nn·ªç·ªç, Chidiuso!", welcomeMessage: "Nn·ªç·ªç na MedMinder!",
        todaysMeds: "·ªågw·ª• Taa", addNewMed: "Tinye ·ªågw·ª• ·ªåh·ª•r·ª•", dayLabel: "·ª§b·ªçch·ªã",
        medNameLabel: "Aha ·ªågw·ª•", dosageLabel: "Usoro", timeLabel: "Oge Iwere",
        addMedButton: "Tinye ·ªågw·ª•", copyright: "MedMinder ¬© 2025",
        designedFor: "Emebere ya maka nd·ªã okenye", privacyPolicy: "Am·ª•ma Nzuzo",
        dayPlaceholder: "d·ªãka M·ªçnde", medNamePlaceholder: "d·ªãka Vitamin D", dosagePlaceholder: "d·ªãka 500mg",
        medicationAdded: "Agbakwunyere ·ªågw·ª•", reminderAlert: "‚è∞ Ncheta: Were {name} ({dose}) n'ime nkeji iri at·ªç",
        goodMorning: "Ut·ª•t·ª• ·ªçma", goodAfternoon: "Ehihie ·ªçma", goodEvening: "Anyas·ªã ·ªçma",
        readPage: "G·ª•·ªç Ibe A", stopReading: "Kw·ª•s·ªã ·ªäg·ª•",
        quotes: [
          "Ah·ª• ike g·ªã b·ª• ak·ª• na ·ª•ba g·ªã üíô", "·ªågw·ª• ·ªç b·ª•la b·ª• nz·ªç·ª•kw·ª• n'ihu ike.",
          "·ªä na-eme nke ·ªçma ‚Äî gaa n'ihu!", "Nz·ªç·ª•kw·ª• nd·ªã d·ªã nta, mmet·ª•ta d·ªã ukwuu. Were ·ªçgw·ª• g·ªã!",
          "Ah·ª• maara otu esi agw·ªç ·ªçr·ªãa ‚Äî any·ªã kwes·ªãr·ªã ige nt·ªã."
        ]
      },
      yo: {
        home: "Ile", schedule: "I·π£eto Akoko", reminders: "Aw·ªçn iranti", settings: "Eto",
        howToUse: "Bii Lati Lo", addedMeds: "Aw·ªçn Oogun Ti A Fikun", profile: "Profaili",
        appName: "MedMinder", welcome: "Kaabo, Chidiuso!", welcomeMessage: "Kaabo si MedMinder!",
        todaysMeds: "Aw·ªçn Oogun Loni", addNewMed: "Fi Oogun Tuntun Kun", dayLabel: "·ªåj·ªç",
        medNameLabel: "Oruk·ªç Oogun", dosageLabel: "Iwon Oogun", timeLabel: "Akoko Lati Mu",
        addMedButton: "Fi Oogun Kun", copyright: "MedMinder ¬© 2025",
        designedFor: "A ·π£e ap·∫πr·∫π p·∫πlu itoju fun aw·ªçn ar·ªçgb·ªç", privacyPolicy: "Ilana Ik·ªçk·ªç",
        dayPlaceholder: "bii Monday", medNamePlaceholder: "bii Vitamin D", dosagePlaceholder: "bii 500mg",
        medicationAdded: "Oogun Ti A Fikun", reminderAlert: "‚è∞ Iranti: Mu {name} ({dose}) ninu i·π£·∫πju aad·ªçta",
        goodMorning: "E kaaro", goodAfternoon: "E kasan", goodEvening: "E ku irole",
        readPage: "Ka Oju-Iwe Yi", stopReading: "Duro Kika",
        quotes: [
          "Ilera r·∫π ni dukia r·∫π üíô", "Gbigbe oogun k·ªç·ªçkan j·∫π igbes·∫π si alagbara.",
          "O n ·π£e daradara ‚Äî t·∫πsiwaju!", "Aw·ªçn igbes·∫π kekere, ipa nla. Mu aw·ªçn oogun r·∫π!",
          "Ara m·ªç bi a ·π£e le wosan ‚Äî a kan nilo lati feti si."
        ]
      },
      ha: {
        home: "Gida", schedule: "Jadawali", reminders: "Tunatarwa", settings: "Saituna",
        howToUse: "Yadda ake Amfani", addedMeds: "Magungunan Da Aka ∆òara", profile: "Bayanan Martaba",
        appName: "MedMinder", welcome: "Barka da zuwa, Chidiuso!", welcomeMessage: "Barka da zuwa MedMinder!",
        todaysMeds: "Magungunan Yau", addNewMed: "∆òara Sabon Magani", dayLabel: "Rana",
        medNameLabel: "Sunan Magani", dosageLabel: "Dozi", timeLabel: "Lokacin Shan",
        addMedButton: "∆òara Magani", copyright: "MedMinder ¬© 2025",
        designedFor: "An tsara shi da kulawa ga tsofaffi", privacyPolicy: "Manufar Sirri",
        dayPlaceholder: "misali Litinin", medNamePlaceholder: "misali Vitamin D", dosagePlaceholder: "misali 500mg",
        medicationAdded: "An ∆òara Magani", reminderAlert: "‚è∞ Tunatarwa: Sha {name} ({dose}) cikin mintuna talatin",
        goodMorning: "Barka da safiya", goodAfternoon: "Barka da rana", goodEvening: "Barka da yamma",
        readPage: "Karanta Wannan Shafi", stopReading: "Dakatar da Karatu",
        quotes: [
          "Lafiyar ku ce dukiyar ku üíô", "Kowane dozi mataki ne zuwa ga ∆ôarfi.",
          "Kuna yin kyau ‚Äî ci gaba!", "∆òananan matakai, babban tasiri. Sha magungunan ku!",
          "Jiki ya san yadda ake warkarwa ‚Äî kawai muna bu∆ôatar sauraro."
        ]
      }
    };

    // Speech synthesis variables
    let currentUtterance = null;
    let isSpeaking = false;

    // Apply translations to the entire page
    function applyTranslation(lang) {
      const t = translations[lang] || translations["en"];
      
      document.querySelectorAll('[data-translate]').forEach(element => {
        const key = element.getAttribute('data-translate');
        if (t[key]) element.textContent = t[key];
      });
      
      // Update form placeholders
      const dayInput = document.getElementById('Day');
      const medNameInput = document.getElementById('medName');
      const dosageInput = document.getElementById('dosage');
      
      if (dayInput && t.dayPlaceholder) dayInput.placeholder = t.dayPlaceholder;
      if (medNameInput && t.medNamePlaceholder) medNameInput.placeholder = t.medNamePlaceholder;
      if (dosageInput && t.dosagePlaceholder) dosageInput.placeholder = t.dosagePlaceholder;
      
      // Update narration button text
      const narrationBtn = document.getElementById('narrationBtn');
      if (narrationBtn) {
        narrationBtn.textContent = isSpeaking ? '‚èπÔ∏è ' + (t.stopReading || 'Stop Reading') : 'üîä ' + (t.readPage || 'Read This Page Aloud');
      }
      
      updateHeader(lang);
      updateDailyQuote(lang);
    }

    // Time-based greeting function with translation
    function getGreeting(lang) {
      const hour = new Date().getHours();
      const t = translations[lang] || translations["en"];
      if (hour < 12) return t.goodMorning;
      if (hour < 18) return t.goodAfternoon;
      return t.goodEvening;
    }

    function updateHeader(lang = 'en') {
      const greeting = getGreeting(lang);
      document.getElementById("headerGreeting").textContent = `${greeting}, Chidiuso!`;
      document.getElementById("headerTime").textContent = new Date().toLocaleString();
    }

    function updateDailyQuote(lang = 'en') {
      const t = translations[lang] || translations["en"];
      const quotes = t.quotes || translations["en"].quotes;
      const quote = quotes[Math.floor(Math.random() * quotes.length)];
      document.getElementById("dailyQuote").textContent = quote;
    }

    // Function to read the entire page content
    function readPageContent() {
      if (isSpeaking) {
        stopReading();
        return;
      }

      const currentLang = document.getElementById("languageSelect").value;
      const t = translations[currentLang] || translations["en"];
      
      let fullText = t.welcomeMessage + ". ";
      
      // Read header content
      fullText += "App Name: " + t.appName + ". ";
      fullText += "Greeting: " + document.getElementById("headerGreeting").textContent + ". ";
      fullText += "Daily Quote: " + document.getElementById("dailyQuote").textContent + ". ";
      
      // Read main sections
      fullText += "Main section: " + document.getElementById("homeSection").textContent + ". ";
      
      // Read today's medications
      const medicationsList = document.getElementById('medications');
      const medications = medicationsList.getElementsByTagName('li');
      
      if (medications.length > 0) {
        fullText += "Today's Medications: ";
        Array.from(medications).forEach((med, index) => {
          const medText = med.textContent.replace('‚úï Remove', '').trim();
          fullText += `Medication ${index + 1}: ${medText}. `;
        });
      } else {
        fullText += "No medications added yet. ";
      }
      
      // Read add medication section
      fullText += "To add a new medication, use the form below. ";
      fullText += "You need to enter the day, medication name, dosage, and time. ";
      
      // Read footer
      const footerText = document.querySelector('footer').textContent.replace(/\s+/g, ' ').trim();
      fullText += "Footer: " + footerText + ". ";
      
      // Speak the content
      speakText(fullText);
    }

    // Speech synthesis function
    function speakText(text) {
      if ('speechSynthesis' in window) {
        // Stop any ongoing speech
        window.speechSynthesis.cancel();
        
        // Create new utterance
        currentUtterance = new SpeechSynthesisUtterance(text);
        currentUtterance.rate = 0.8;
        currentUtterance.pitch = 1;
        currentUtterance.volume = 1;
        
        // Set language based on selection
        const currentLang = document.getElementById("languageSelect").value;
        if (currentLang === 'ig') currentUtterance.lang = "ig-NG";
        else if (currentLang === 'yo') currentUtterance.lang = "yo-NG";
        else if (currentLang === 'ha') currentUtterance.lang = "ha-NG";
        else currentUtterance.lang = "en-US";
        
        // Update UI when speaking starts
        currentUtterance.onstart = function() {
          isSpeaking = true;
          document.body.classList.add('speaking');
          const narrationBtn = document.getElementById('narrationBtn');
          const t = translations[currentLang] || translations["en"];
          narrationBtn.textContent = '‚èπÔ∏è ' + (t.stopReading || 'Stop Reading');
          narrationBtn.disabled = false;
        };
        
        // Update UI when speaking ends
        currentUtterance.onend = function() {
          isSpeaking = false;
          document.body.classList.remove('speaking');
          const narrationBtn = document.getElementById('narrationBtn');
          const t = translations[currentLang] || translations["en"];
          narrationBtn.textContent = 'üîä ' + (t.readPage || 'Read This Page Aloud');
          narrationBtn.disabled = false;
        };
        
        currentUtterance.onerror = function() {
          isSpeaking = false;
          document.body.classList.remove('speaking');
          const narrationBtn = document.getElementById('narrationBtn');
          const t = translations[currentLang] || translations["en"];
          narrationBtn.textContent = 'üîä ' + (t.readPage || 'Read This Page Aloud');
          narrationBtn.disabled = false;
          alert('Speech synthesis error. Please try again.');
        };
        
        // Start speaking
        window.speechSynthesis.speak(currentUtterance);
      } else {
        alert('Text-to-speech is not supported in your browser. Please try using Chrome, Edge, or Safari.');
      }
    }

    // Stop reading function
    function stopReading() {
      if ('speechSynthesis' in window) {
        window.speechSynthesis.cancel();
        isSpeaking = false;
        document.body.classList.remove('speaking');
        const currentLang = document.getElementById("languageSelect").value;
        const t = translations[currentLang] || translations["en"];
        const narrationBtn = document.getElementById('narrationBtn');
        narrationBtn.textContent = 'üîä ' + (t.readPage || 'Read This Page Aloud');
        narrationBtn.disabled = false;
      }
    }

    // Load medications from localStorage on page load
    function loadMedications() {
      const medicationsList = document.getElementById('medications');
      medicationsList.innerHTML = '';
      
      const userMedications = JSON.parse(localStorage.getItem('userMedications') || '[]');
      
      userMedications.forEach(med => {
        const listItem = document.createElement('li');
        listItem.innerHTML = `
          <strong>${med.name}</strong> ‚Äì ${med.dose} at <em>${med.time}</em>
          <button class="remove-btn" onclick="removeMedication('${med.name}', '${med.dose}', '${med.time}', '${med.day}')">
            ‚úï Remove
          </button>
        `;
        medicationsList.appendChild(listItem);
      });
    }

    // Remove medication function
    function removeMedication(name, dose, time, day) {
      if (confirm(`Remove ${name} (${dose}) from ${day} at ${time}?`)) {
        const userMedications = JSON.parse(localStorage.getItem('userMedications') || '[]');
        const updatedMeds = userMedications.filter(med => 
          !(med.name === name && med.dose === dose && med.time === time && med.day === day)
        );
        localStorage.setItem('userMedications', JSON.stringify(updatedMeds));
        loadMedications(); // Refresh the display
      }
    }

    // Enhanced duplicate checking - checks localStorage
    function isDuplicateMedication(name, dose, time, day) {
      const userMedications = JSON.parse(localStorage.getItem('userMedications') || '[]');
      return userMedications.some(med => 
        med.name.toLowerCase() === name.toLowerCase() && 
        med.dose.toLowerCase() === dose.toLowerCase() && 
        med.time === time &&
        med.day === day
      );
    }

    // Medication form handling - FIXED with localStorage integration
    document.getElementById("medForm").addEventListener("submit", function(e) {
      e.preventDefault();

      const day = document.getElementById("Day").value.trim();
      const name = document.getElementById("medName").value.trim();
      const dose = document.getElementById("dosage").value.trim();
      const time = document.getElementById("time").value;

      // VALIDATION: Check for empty fields
      if (!day || !name || !dose || !time) {
        alert("‚ùå Please fill all fields");
        return;
      }

      // VALIDATION: Check for duplicates in localStorage
      if (isDuplicateMedication(name, dose, time, day)) {
        alert("‚ùå This medication is already in your list!");
        return;
      }

      // Save to localStorage
      const userMedications = JSON.parse(localStorage.getItem('userMedications') || '[]');
      userMedications.push({ name, dose, time, day });
      localStorage.setItem('userMedications', JSON.stringify(userMedications));

      // Refresh display
      loadMedications();
      this.reset();
    });

    // Initialize the page
    window.addEventListener("DOMContentLoaded", () => {
      const defaultLang = document.getElementById("languageSelect").value;
      applyTranslation(defaultLang);
      loadMedications(); // Load existing medications
      
      // Add event listener for narration button
      const narrationBtn = document.getElementById('narrationBtn');
      if (narrationBtn) {
        narrationBtn.addEventListener('click', readPageContent);
      }
      
      setInterval(() => {
        const currentLang = document.getElementById("languageSelect").value;
        updateHeader(currentLang);
      }, 1800000);
    });

    // Language selector event listener
    document.getElementById("languageSelect").addEventListener("change", (e) => {
      applyTranslation(e.target.value);
    });
  </script>
</body>
</html>

